<h1 mat-dialog-title>
  {{ data.type === "followers" ? "Followers" : "Following" }}
</h1>

<div class="p-2">
  @if(data.followUsers && data.followUsers.length > 0) {
  <table
    mat-table
    [dataSource]="data.followUsers"
    class="w-100 rounded overflow-scroll"
  >
    <ng-container matColumnDef="user">
      <th mat-header-cell *matHeaderCellDef>User</th>
      <td mat-cell *matCellDef="let followUser">
        <div class="d-flex align-items-center gap-2">
          <!-- Avatar container -->
          <div class="avatar-container">
            @if (followUser._profileSrc && !followUser._imgError) {
            <img
              class="profilePicture"
              [src]="followUser._profileSrc"
              height="40"
              width="40"
              alt="Profile"
              (error)="followUser._imgError = true"
            />
            } @else {
            <div class="profile-avatar-placeholder mat-elevation-z1">
              {{ getInitials(followUser.display_name) }}
            </div>
            }
          </div>
          <span>{{ followUser.display_name }}</span>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="duration">
      <th mat-header-cell *matHeaderCellDef>Duration</th>
      <td mat-cell *matCellDef="let followUser">
        {{ followUser.start_following | followDuration }}
      </td>
    </ng-container>

    <ng-container matColumnDef="open">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let followUser">
        <a
          [routerLink]="['/u', followUser.uid]"
          (click)="closeDialog()"
          mat-icon-button
          color="primary"
          aria-label="Open profile"
        >
          <mat-icon>open_in_new</mat-icon>
        </a>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
  } @if(data.followUsers && data.followUsers.length === 0) {
  <p class="text-center mat-body-medium text-muted mt-3">
    @if(data.isMyProfile) {
    {{
      data.type === "followers"
        ? "You have no followers yet."
        : "You aren't following anyone yet."
    }}
    } @else {
    {{
      data.type === "followers"
        ? (data.displayName || "This user") + " has no followers yet."
        : (data.displayName || "This user") + " isn't following anyone yet."
    }}
    }
  </p>
  }
</div>

<div class="d-flex justify-content-center pt-3">
  @if(isLoading) {
  <mat-spinner color="primary" [diameter]="32"></mat-spinner>
  }
</div>

<div class="d-flex justify-content-center py-2">
  @if(!isLoading && !hasLoadedAll) {
  <button mat-raised-button color="accent" (click)="loadMoreFollowing()">
    Load More
  </button>
  }
</div>
