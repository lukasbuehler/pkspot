<div class="profile-page">
  @if (isLoading) {
  <div class="profile-state" aria-live="polite">
    <mat-spinner
      diameter="48"
      strokeWidth="4"
      aria-label="Loading profile"
    ></mat-spinner>
  </div>
  } @else { @if (user) {
  <div class="profile-grid">
    <section class="profile-primary" aria-label="Profile overview">
      <mat-card class="profile-overview__card mat-elevation-z1">
        <mat-card-content>
          <div class="profile-overview__content">
            @if (profilePicture) {
            <img
              class="profile-overview__avatar"
              [src]="profilePicture"
              [alt]="
                user.displayName
                  ? user.displayName + ' profile picture'
                  : 'Profile picture'
              "
            />
            } @else {
            <div
              class="profile-overview__avatar profile-overview__avatar--placeholder mat-display-small"
              aria-hidden="true"
            >
              {{ user.displayName ? user.displayName.charAt(0) : "?" }}
            </div>
            }

            <div class="profile-overview__details">
              <div class="profile-overview__heading">
                <span class="mat-headline-small profile-overview__name">
                  {{ user.displayName }}
                </span>
                <mat-chip-set aria-label="Profile status">
                  @if (isMyProfile) {
                  <mat-chip color="primary" class="mat-label-large"
                    >You</mat-chip
                  >
                  }
                </mat-chip-set>
              </div>

              @if (user.startTimeDiffString) {
              <p class="mat-body-large profile-overview__tenure">
                Freerunner since {{ user.startTimeDiffString }}
              </p>
              }

              <div class="profile-overview__metric mat-title-medium">
                <span class="profile-overview__metric-value">
                  <app-fancy-counter
                    [number]="user.followerCount || 0"
                  ></app-fancy-counter>
                </span>
                Follower{{ user.followerCount === 1 ? "" : "s" }}
              </div>

              @if (!isMyProfile) {
              <div
                class="profile-overview__actions"
                aria-label="Profile actions"
              >
                <button
                  [matButton]="isFollowing ? 'outlined' : 'filled'"
                  color="primary"
                  class="profile-overview__action"
                  (click)="followButtonClick()"
                >
                  @if (loadingFollowing) {
                  <mat-spinner
                    diameter="20"
                    strokeWidth="3"
                    class="profile-overview__action-spinner"
                    aria-label="Updating follow status"
                  ></mat-spinner>
                  } @if(isFollowing) {
                  <span i18n>Unfollow</span>
                  } @else {
                  <span i18n>Follow</span>
                  }
                </button>
                <!-- <button
                  mat-stroked-button
                  color="primary"
                  class="profile-overview__action"
                >
                  Contact
                </button> -->
                <button
                  mat-stroked-button
                  color="warn"
                  class="profile-overview__action"
                >
                  Block
                </button>
              </div>
              } @else {
              <div
                class="profile-overview__actions"
                aria-label="Profile management actions"
              >
                <button
                  mat-stroked-button
                  color="primary"
                  class="profile-overview__action"
                  (click)="viewFollowers()"
                >
                  Followers
                </button>
                <button
                  mat-stroked-button
                  color="primary"
                  class="profile-overview__action"
                  (click)="viewFollowing()"
                >
                  Following
                </button>
                <button
                  mat-stroked-button
                  color="accent"
                  class="profile-overview__action"
                  routerLink="/settings/profile"
                >
                  Edit Profile
                </button>
              </div>
              }
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="profile-section mat-elevation-z1">
        <mat-card-header class="profile-section__header">
          <mat-card-title class="mat-title-small">Posts</mat-card-title>
        </mat-card-header>
        <mat-card-content class="profile-section__content">
          <p class="mat-body-medium profile-section__placeholder">
            Posts from {{ user.displayName || "this athlete" }} will appear here
            soon.
          </p>
        </mat-card-content>
      </mat-card>
    </section>

    <section class="profile-secondary" aria-label="Additional profile details">
      <mat-card class="profile-section mat-elevation-z1">
        <mat-card-header class="profile-section__header">
          <mat-card-title class="mat-title-small">Biography</mat-card-title>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content
          class="profile-section__content profile-section__content--with-divider"
        >
          @if (user.biography) {
          <p class="mat-body-medium profile-bio__text">
            {{ user.biography }}
          </p>
          } @else {
          <p class="mat-body-medium profile-section__placeholder">
            This runner has not added a biography yet.
          </p>
          }
        </mat-card-content>
      </mat-card>

      <mat-card class="profile-section mat-elevation-z1">
        <mat-card-header class="profile-section__header">
          <mat-card-title class="mat-title-small"
            >More coming soon</mat-card-title
          >
        </mat-card-header>
        <mat-card-content class="profile-section__content">
          <p class="mat-body-medium profile-section__placeholder">
            Highlights, achievements, and other stats will live here in a future
            update.
          </p>
        </mat-card-content>
      </mat-card>
    </section>
  </div>
  } @else {
  <div class="profile-state" aria-live="polite">
    <p class="mat-body-medium">This user does not exist!</p>
  </div>
  } }
</div>
